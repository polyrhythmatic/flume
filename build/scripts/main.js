function resetInactivityTimeout(){clearTimeout(inactivityTimeout),inactivityTimeout=setTimeout(function(){$(".header").removeClass("hidden"),$(".playlist").removeClass("hidden"),$(".instrument__buttons").removeClass("bring-to-front")},7e3)}function handleButtonClick(e,t){console.log(e+", "+t);var n=Math.floor(e/buttonWidth),a=Math.floor(t/buttonHeight);lastButtonX=n,lastButtonY=a,drawButton(n,a),playVocalSound(n,a)}function handleButtonMove(e,t){var n=Math.floor(e/buttonWidth),a=Math.floor(t/buttonHeight);n===lastButtonX&&a===lastButtonY||(lastButtonX=n,lastButtonY=a,drawButton(n,a),playVocalSound(n,a))}function drawButton(e,t){buttonContext.fillStyle="rgba(255, 255, 255, 0.3)",buttonContext.fillRect(e*buttonWidth,t*buttonHeight,buttonWidth,buttonHeight),setTimeout(function(){buttonContext.clearRect(0,0,window.innerWidth,window.innerHeight)},100)}function playVocalSound(e,t){if(0===e)switch(t){case 0:schedulePlay(1);break;case 1:schedulePlay(4);break;case 2:schedulePlay(5);break;case 3:schedulePlay(8);break;case 4:schedulePlay(9);break;case 5:schedulePlay(12);break;case 6:schedulePlay(13)}else switch(t){case 0:schedulePlay(2);break;case 1:schedulePlay(3);break;case 2:schedulePlay(6);break;case 3:schedulePlay(7);break;case 4:schedulePlay(10);break;case 5:schedulePlay(11);break;case 6:schedulePlay(14)}}function handleMouseover(e){switch(e=e[0].toString()+e[1].toString()+e[2].toString()){case"000":0!==currentMouse&&sampler.triggerRelease(Tone.context.currentTime),currentMouse=0;break;case"255255255":schedulePlay(1),currentMouse=1;break;case"2552550":schedulePlay(2),currentMouse=2;break;case"2550255":schedulePlay(3),currentMouse=3;break;case"0255255":schedulePlay(4),currentMouse=4;break;case"25500":schedulePlay(5),currentMouse=5;break;case"02550":schedulePlay(6),currentMouse=6;break;case"00255":schedulePlay(7),currentMouse=7;break;case"858585":schedulePlay(8),currentMouse=8;break;case"85850":schedulePlay(9),currentMouse=9;break;case"08585":schedulePlay(10),currentMouse=10;break;case"85085":schedulePlay(11),currentMouse=11;break;case"8500":schedulePlay(12),currentMouse=12;break;case"0085":schedulePlay(13),currentMouse=13;break;case"0850":schedulePlay(14),currentMouse=14}}function schedulePlay(e){if(currentMouse!=e){var t=Math.floor(Tone.context.currentTime/.125);t=.125*t+.125,console.log(Tone.Transport.toSeconds(t+"n")),sampler.triggerRelease(t),sampler.triggerAttack("A."+e,t)}}var maskContext,mask,maskVisible=!1,animationCanvas,animationContext,masks=[],maskLoader=0,buttonWidth,buttonHeight,buttonContext,lastButtonX,lastButtonY,inactivityTimeout,isInstrumentalPlaying=!1,trackPlayedOnce=!1;window.onload=function(){var e=document.getElementById("myCanvas");animationCanvas=document.getElementById("animationCanvas"),animationContext=animationCanvas.getContext("2d"),animationContext.shadowBlur=10,animationContext.shadowColor="yellow";var t=e.getContext("2d");t.globalAlpha=.01;var n=new Image;n.src="images/mask.png",n.onload=function(){t.drawImage(n,0,0,720,720)};for(var a=0;14>a;a++)masks[a]=new Image,masks[a].src="images/masks/"+(a+1)+".png",masks[a].onload=function(){maskLoader++,14==maskLoader&&console.log("all masks loaded")};e.onmousemove=function(e){handleMouseover(t.getImageData(e.offsetX,e.offsetY,1,1).data)};var o=document.getElementById("button-canvas");o.width=window.innerWidth,o.height=window.innerHeight,buttonWidth=window.innerWidth/2,buttonHeight=window.innerHeight/7,buttonContext=o.getContext("2d"),o.ontouchstart=function(e){console.log(e);for(var t=0;t<e.touches.length;t++){var n=e.touches[t].clientX,a=e.touches[t].clientY;handleButtonClick(n,a)}resetInactivityTimeout()},o.ontouchmove=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t].clientX,a=e.changedTouches[t].clientY;handleButtonMove(n,a)}resetInactivityTimeout()},o.ontouchend=function(e){lastButtonX=-1,lastButtonY=-1},document.getElementById("content").ontouchstart=function(e){console.log("content touch"),isInstrumentalPlaying?(instrumental.stop(),$(".header__flash-content").text("Start Track"),isInstrumentalPlaying=!1):trackPlayedOnce&&(instrumental.start(),$(".header__flash-content").text("Stop Track"),isInstrumentalPlaying=!0)},document.body.ontouchstart=function(e){console.log("document on touch start"),$(".header").hasClass("hidden")||"content"===e.target.id||($(".header").addClass("hidden"),$(".playlist").addClass("hidden"),$(".instrument__buttons").addClass("bring-to-front"),isInstrumentalPlaying||trackPlayedOnce||($(".header__flash").removeClass("animate-flicker"),instrumental.start(),$(".header__flash-content").text("Stop Track"),$(".header__flash-content").css("border","2px solid white"),isInstrumentalPlaying=!0,trackPlayedOnce=!0),resetInactivityTimeout())},$(".instrument__start-button").click(function(){instrumental.start(),$(this).addClass("hidden"),$(".instrument__stop-button").removeClass("hidden")}),$(".instrument__stop-button").click(function(){instrumental.stop(),$(this).addClass("hidden"),$(".instrument__play-button").removeClass("hidden")}),$(".instrument__play-button").click(function(){instrumental.start(),$(this).addClass("hidden"),$(".instrument__stop-button").removeClass("hidden")})};var currentMouse=0,sampler=new Tone.Sampler({A:{1:"sounds/vocals/1.wav",2:"sounds/vocals/2.wav",3:"sounds/vocals/3.wav",4:"sounds/vocals/4.wav",5:"sounds/vocals/5.wav",6:"sounds/vocals/6.wav",7:"sounds/vocals/7.wav",8:"sounds/vocals/8.wav",9:"sounds/vocals/9.wav",10:"sounds/vocals/10.wav",11:"sounds/vocals/11.wav",12:"sounds/vocals/12.wav",13:"sounds/vocals/13.wav",14:"sounds/vocals/14.wav"}}).toMaster(),instrumental=new Tone.Player({url:"sounds/instrumental.wav"}).toMaster(),click=new Tone.SimpleSynth({envelope:{decay:.01,release:0,sustain:0}}).toMaster(),loop=new Tone.Loop(function(e){},"4n").start(0);Tone.Buffer.on("load",function(){Tone.Transport.start()});