function resetInactivityTimeout(){clearTimeout(inactivityTimeout),inactivityTimeout=setTimeout(function(){$(".header").removeClass("hidden"),$(".playlist").removeClass("hidden"),$(".instrument__buttons").removeClass("bring-to-front")},7e3)}function handleButtonClick(t,e){console.log(t+", "+e);var a=Math.floor(t/buttonWidth),n=Math.floor(e/buttonHeight);lastButtonX=a,lastButtonY=n,drawButton(a,n),playVocalSound(a,n)}function handleButtonMove(t,e){var a=Math.floor(t/buttonWidth),n=Math.floor(e/buttonHeight);a===lastButtonX&&n===lastButtonY||(lastButtonX=a,lastButtonY=n,drawButton(a,n),playVocalSound(a,n))}function drawButton(t,e){buttonContext.fillStyle="rgba(255, 255, 255, 0.3)",buttonContext.fillRect(t*buttonWidth,e*buttonHeight,buttonWidth,buttonHeight),setTimeout(function(){buttonContext.clearRect(0,0,window.innerWidth,window.innerHeight)},100)}function playVocalSound(t,e){if(0===t)switch(e){case 0:schedulePlay(1);break;case 1:schedulePlay(4);break;case 2:schedulePlay(5);break;case 3:schedulePlay(8);break;case 4:schedulePlay(9);break;case 5:schedulePlay(12);break;case 6:schedulePlay(13)}else switch(e){case 0:schedulePlay(2);break;case 1:schedulePlay(3);break;case 2:schedulePlay(6);break;case 3:schedulePlay(7);break;case 4:schedulePlay(10);break;case 5:schedulePlay(11);break;case 6:schedulePlay(14)}}function handleMouseover(t){switch(t=t[0].toString()+t[1].toString()+t[2].toString()){case"000":0!==currentMouse&&sampler.triggerRelease(Tone.context.currentTime),currentMouse=0;break;case"255255255":schedulePlay(1),currentMouse=1;break;case"2552550":schedulePlay(2),currentMouse=2;break;case"2550255":schedulePlay(3),currentMouse=3;break;case"0255255":schedulePlay(4),currentMouse=4;break;case"25500":schedulePlay(5),currentMouse=5;break;case"02550":schedulePlay(6),currentMouse=6;break;case"00255":schedulePlay(7),currentMouse=7;break;case"858585":schedulePlay(8),currentMouse=8;break;case"85850":schedulePlay(9),currentMouse=9;break;case"08585":schedulePlay(10),currentMouse=10;break;case"85085":schedulePlay(11),currentMouse=11;break;case"8500":schedulePlay(12),currentMouse=12;break;case"0085":schedulePlay(13),currentMouse=13;break;case"0850":schedulePlay(14),currentMouse=14}}function schedulePlay(t){if(console.log(t),currentMouse!=t){animationContext.clearRect(0,0,animationCanvas.width,animationCanvas.height),animationContext.drawImage(masks[t-1],0,0,animationCanvas.width,animationCanvas.height);var e=Math.floor(Tone.context.currentTime/.125);e=.125*e+.125,sampler.triggerRelease(e),sampler.triggerAttack("A."+t,e)}}var maskContext,mask,maskVisible=!1,animationCanvas,animationContext,masks=[],maskLoader=0,buttonWidth,buttonHeight,buttonContext,lastButtonX,lastButtonY,inactivityTimeout,isInstrumentalPlaying=!1,trackPlayedOnce=!1;window.onload=function(){var t=document.getElementById("myCanvas");animationCanvas=document.getElementById("animationCanvas"),animationContext=animationCanvas.getContext("2d");var e=t.getContext("2d");e.globalAlpha=.01;var a=new Image;a.src="images/mask.png",a.onload=function(){e.drawImage(a,0,0,720,720)};for(var n=0;14>n;n++)masks[n]=new Image,masks[n].src="images/masks/"+(n+1)+".png",masks[n].onload=function(){maskLoader++,14==maskLoader&&console.log("all masks loaded")};t.onmousemove=function(t){handleMouseover(e.getImageData(t.offsetX,t.offsetY,1,1).data)};var s=document.getElementById("button-canvas");s.width=window.innerWidth,s.height=window.innerHeight,buttonWidth=window.innerWidth/2,buttonHeight=window.innerHeight/7,buttonContext=s.getContext("2d"),s.ontouchstart=function(t){console.log(t);for(var e=0;e<t.touches.length;e++){var a=t.touches[e].clientX,n=t.touches[e].clientY;handleButtonClick(a,n)}resetInactivityTimeout()},s.ontouchmove=function(t){for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e].clientX,n=t.changedTouches[e].clientY;handleButtonMove(a,n)}resetInactivityTimeout()},s.ontouchend=function(t){lastButtonX=-1,lastButtonY=-1},document.getElementById("content").ontouchstart=function(t){console.log("content touch"),isInstrumentalPlaying?(instrumental.stop(),$(".header__flash-content").text("Start Track"),isInstrumentalPlaying=!1):trackPlayedOnce&&(instrumental.start(),$(".header__flash-content").text("Stop Track"),isInstrumentalPlaying=!0)},document.body.ontouchstart=function(t){console.log("document on touch start"),$(".header").hasClass("hidden")||"content"===t.target.id||($(".header").addClass("hidden"),$(".playlist").addClass("hidden"),$(".instrument__buttons").addClass("bring-to-front"),isInstrumentalPlaying||trackPlayedOnce||($(".header__flash").removeClass("animate-flicker"),instrumental.start(),$(".header__flash-content").text("Stop Track"),$(".header__flash-content").css("border","2px solid white"),isInstrumentalPlaying=!0,trackPlayedOnce=!0),resetInactivityTimeout())},$(".instrument__start-button").click(function(){instrumental.start(),$(this).addClass("hidden"),$(".instrument__stop-button").removeClass("hidden")}),$(".instrument__stop-button").click(function(){instrumental.stop(),$(this).addClass("hidden"),$(".instrument__play-button").removeClass("hidden")}),$(".instrument__play-button").click(function(){instrumental.start(),$(this).addClass("hidden"),$(".instrument__stop-button").removeClass("hidden")})};var currentMouse=0,sampler=new Tone.Sampler({A:{1:"sounds/vocals/1.wav",2:"sounds/vocals/2.wav",3:"sounds/vocals/3.wav",4:"sounds/vocals/4.wav",5:"sounds/vocals/5.wav",6:"sounds/vocals/6.wav",7:"sounds/vocals/7.wav",8:"sounds/vocals/8.wav",9:"sounds/vocals/9.wav",10:"sounds/vocals/10.wav",11:"sounds/vocals/11.wav",12:"sounds/vocals/12.wav",13:"sounds/vocals/13.wav",14:"sounds/vocals/14.wav"}}).toMaster(),instrumental=new Tone.Player({url:"sounds/instrumental.wav"}).toMaster(),click=new Tone.SimpleSynth({envelope:{decay:.01,release:0,sustain:0}}).toMaster(),loop=new Tone.Loop(function(t){},"4n").start(0);Tone.Buffer.on("load",function(){Tone.Transport.start()});